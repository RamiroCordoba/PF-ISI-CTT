{% extends 'dashboard/principal.html' %}
{% block Contenido %}
<div class="container-fluid px-4">
  <h1 class="mt-4">Proveedores</h1>
  <hr style="height: 5px; background-color: black; border: none" />


  <!-- Fila de funciones generales y filtros -->
  <div class="d-flex justify-content-between align-items-center py-2">
    <div class="d-flex gap-2 flex-wrap">
      {% if request.user.is_staff %}
      <a href="{% url 'nuevo_proveedor' %}" class="btn btn-primary">
        Nuevo proveedor
      </a>
      {% endif %}
    </div>

    <!-- Filtros y buscador -->
    <div class="d-flex align-items-end gap-3 flex-wrap">
      <form method="get" class="d-flex align-items-end gap-3 flex-wrap">
        <!-- ...existing code... -->
      </form>
    </div>
  </div>
  <!-- Mostrador de filtros activos -->
  {% if filtros_activos or buscar %}
    <div class="text-secondary small mt-3">
      <strong>Se está filtrando por:</strong>
      {% if filtro_empresa %}
        Empresa: <span><strong>{{ filtro_empresa }}</strong></span>
      {% endif %}
      {% if filtro_categorias %}
        {% if filtro_empresa %}, {% endif %}
        Categoría/s:
        <span>
          {% for id in filtro_categorias %}
            {% for cat in categorias %}
              {% if cat.id|stringformat:"s" == id %}
                <strong>{{ cat.nombre }}</strong>{% if not forloop.last or not forloop.parentloop.last %}, {% endif %}
              {% endif %}
            {% endfor %}
          {% endfor %}
        </span>
      {% endif %}
      
      {% if filtro_estado %}
        {% if filtro_empresa or filtro_categorias %}, {% endif %}
        Estado: <span><strong>{% if filtro_estado == 'activos' %}Activos{% elif filtro_estado == 'inactivos' %}Inactivos{% endif %}</strong></span>
      {% endif %}
      {% if buscar %}
        {% if filtro_empresa or filtro_categorias or filtro_estado %}, {% endif %}
        Búsqueda de texto: <span><strong>"{{ buscar }}"</strong></span>
      {% endif %}
    </div>
  {% endif %}
    </div>
  </div>
  <!-- Fin fila funciones generales y filtros -->

  <hr style="height: 5px; background-color: black; border: none" />

  <table class="table table-striped text-center align-middle">
    <thead>
      <tr>
        {% if request.user.is_staff %}
        <th class="text-center">Acciones</th>
        <th class="text-center">Contacto</th>
        {% endif %}
        <th class="text-center">Empresa</th>
        <th class="text-center">Nombre del proveedor</th>
        <th class="text-center">Categorias asociadas</th>
        <th class="text-center">Estado</th>
      </tr>
    </thead>
    <tbody>
      {% if proveedores %}
        {% for p in proveedores %}
        <tr>
          {% if request.user.is_staff %}
          <!-- Columna de acciones -->
          <td class="text-center">
            <a href="{% url 'detalles_de_proveedor' p.id %}" class="btn btn-outline-primary mt-2"
              style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;">
              <i class="fa-solid fa-eye" title="Ver"></i>
            </a>
            <a href="{% url 'editar_proveedor' p.id %}" class="btn btn-outline-success mt-2"
              style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;">
              <i class="fa fa-edit fa-sm" title="Editar"></i>
            </a>
            <a href="{% url 'eliminar_proveedor' p.id %}" class="btn btn-outline-danger mt-2"
              style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;">
              <i class="fa fa-trash fa-sm" title="Eliminar"></i>
            </a>
          </td>

          <!-- Columna de contacto -->
          <td class="text-center">
            <a href="https://wa.me/{{ p.telefono }}" target="_blank"
              class="btn btn-outline-success mt-2 me-1"
              style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;"
              title="WhatsApp">
              <i class="fab fa-whatsapp fa-sm"></i>
            </a>
            <a href="mailto:{{ p.mail }}?subject=Solicitud%20de%20Ferreteria%20Santa%20Rita%20-%20Rosario&body=--%0D%0ASaludos,%20Ferreteria%20Santa%20Rita."
              class="btn btn-outline-primary mt-2"
              style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;"
              title="Enviar correo">
              <i class="fa-solid fa-envelope"></i>
            </a>
          </td>
          {% endif %}
          <td class="text-center">{{ p.nombreEmpresa }}</td>
          <td class="text-center">{{ p.nombreProv }}</td>
          <td>
            {% for cat in p.categoria.all %}
            {{ cat.nombre }}{% if not forloop.last %}, {% endif %}
            {% empty %}
              No asignadas
            {% endfor %}
          </td>                         
          <td>
            <span class="badge {% if p.estado %}bg-success{% else %}bg-danger{% endif %} px-3 py-2">
              {% if p.estado %}Activo{% else %}Inactivo{% endif %}
            </span>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="6" class="text-center">No se encontraron proveedores.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock Contenido %}
