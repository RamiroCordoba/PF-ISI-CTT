{% extends 'dashboard/principal.html' %} {% load static %} {% block Contenido %}
<div class="container-fluid px-4">
  <!-- Breadcrumb -->
  <nav
    aria-label="breadcrumb"
    class="mt-4 rounded px-3 py-2"
    style="background-color: #f0f0f0"
  >
    <ol class="breadcrumb mb-0 text-muted">
      <li class="breadcrumb-item">
        <a
          href="{% url 'dashboard' %}"
          class="text-decoration-none text-muted fw-bold"
          >Inicio</a
        >
      </li>
      <li class="breadcrumb-item">
        <a
          href="{% url 'mis_articulos' %}"
          class="text-decoration-none text-muted fw-bold"
          >Mis artículos</a
        >
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ elArticulo.nombre }}
      </li>
    </ol>
  </nav>
  <hr style="height: 3px; background-color: black; border: none" />
  <!-- Título y botones -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">{{ elArticulo.nombre }}</h1>
    <div class="d-flex gap-2 mt-2">
      <a href="{% url 'mis_articulos' %}" class="btn btn-outline-secondary">
        <i class="fa fa-arrow-left me-1"></i> Volver
      </a>
      {% if request.user.is_staff %}
      <a
        href="{% url 'editar_articulo' elArticulo.id %}"
        class="btn btn-outline-success"
      >
        <i class="fa fa-edit me-1"></i> Editar
      </a>
      {%endif%}
    </div>
  </div>
  <!-- Separador -->
  <hr class="my-3 border-top border-2 border-dark-subtle" />
  <div class="container mt-5">
    <div class="row">
      <!-- Imagen -->
      <div class="col-md-4 text-center">
        <img
          src="{% static 'principal/assets/img/404_no_img_producto.png' %}"
          alt="Imagen del artículo"
          class="img-fluid border mb-3 rounded"
        />
        <!-- Estado del artículo -->
        <div class="mb-3">
          <span
            class="badge {% if elArticulo.activo %}bg-success{% else %}bg-danger{% endif %} px-3 py-2"
          >
            {% if elArticulo.activo %}Activo{% else %}Inactivo{% endif %}
          </span>
        </div>
      </div>
      <div class="col-md-1 d-none d-md-block">
        <div class="vr h-100"></div>
      </div>
      <!-- Información general -->
        <div class="col-md-7">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs mb-3" id="articuloTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab" aria-controls="info" aria-selected="true">
              Información General
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="proveedores-tab" data-bs-toggle="tab" data-bs-target="#proveedores" type="button" role="tab" aria-controls="proveedores" aria-selected="false">
              Proveedores
            </button>
          </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content" id="articuloTabsContent">
          <!-- Información General -->
          <div class="tab-pane fade show active" id="info" role="tabpanel" aria-labelledby="info-tab">
            <p><strong>Marca:</strong> {{ elArticulo.marca }}</p>
            <p><strong>Categoría:</strong> {{ elArticulo.categoria }}</p>
            <p><strong>Precio:</strong> ${{ elArticulo.precio }}</p>
            <hr />
            <p><strong>Descripción:</strong></p>
            <div
              class="border rounded p-3 mb-3"
              style="min-height: 100px; border-color: #6c757d"
            >
              {{ elArticulo.descripcion }}
            </div>
            <hr />
            <p>
              <strong>Fecha de registro:</strong>
              {{ elArticulo.fecha_registro|date:"d/m/Y" }}
            </p>
            <p>
              <strong>Último ingreso:</strong>
              {{ elArticulo.fecha_ultimo_ingreso|date:"d/m/Y" }}
            </p>
            <hr />
            <div style="display: flex; justify-content: space-between; width: 100%">
              <div><strong>Stock actual:</strong> {{ elArticulo.stock }}</div>
              <div><strong>Stock mínimo:</strong> {{ elArticulo.stock_minimo }}</div>
              <div><strong>Stock máximo:</strong> {{ elArticulo.stock_maximo }}</div>
            </div>
            <hr class="my-4" />
          </div>

          <!-- Proveedores -->
          <div class="tab-pane fade" id="proveedores" role="tabpanel" aria-labelledby="proveedores-tab">
            <h5>Proveedores asociados</h5>
            <!-- Formulario para agregar proveedor -->
            <form method="post" class="mb-3 d-flex align-items-end gap-2">
              {% csrf_token %}
              <div>
                <label for="proveedor_id" class="form-label mb-0">Agregar proveedor:</label>
                <select name="proveedor_id" id="proveedor_id" class="form-select" required>
                  <option value="">Seleccione...</option>
                  {% for proveedor in todos_proveedores %}
                    <option value="{{ proveedor.id }}">{{ proveedor.nombreEmpresa }}</option>
                  {% endfor %}
                </select>
              </div>
              <button type="submit" class="btn btn-success">Agregar</button>
            </form>

            <!-- Grilla de proveedores asociados -->
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th></th>
                  <th>Empresa</th>
                  <th>Proveedor</th>
                  <th>Acciones</th>
                </tr>
              </thead>
<tbody>
  {% for proveedor in elArticulo.proveedores.all %}
    <tr>
<td class="text-center align-middle">
  <div class="d-flex justify-content-center">
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="quitar_proveedor_id" value="{{ proveedor.id }}">
      <button type="submit"
              class="btn btn-outline-danger d-flex align-items-center justify-content-center"
              style="width: 36px; height: 36px; font-size: 1rem; border-radius: 6px;"
              title="Quitar proveedor"
              onclick="return confirm('¿Seguro que deseas quitar este proveedor?');">
        <i class="fa-solid fa-xmark m-0"></i>
      </button>
    </form>
  </div>
</td>


      <!-- Empresa y Proveedor -->
      <td class="align-middle">{{ proveedor.nombreEmpresa }}</td>
      <td class="align-middle">{{ proveedor.nombreProv }}</td>

      <!-- Acciones centradas -->
      <td class="text-center align-middle">
        <div class="d-flex justify-content-center flex-wrap gap-2">
          <a href="https://wa.me/{{ proveedor.telefono }}" target="_blank"
             class="btn btn-outline-success d-flex align-items-center justify-content-center"
             style="width: 36px; height: 36px; font-size: 1rem;"
             title="WhatsApp">
            <i class="fab fa-whatsapp fa-sm"></i>
          </a>

          <a href="mailto:{{ proveedor.mail }}?subject=Solicitud%20de%20Ferreteria%20Santa%20Rita%20-%20Rosario&body=--%0D%0ASaludos,%20Ferreteria%20Santa%20Rita."
             class="btn btn-outline-primary d-flex align-items-center justify-content-center"
             style="width: 36px; height: 36px; font-size: 1rem;"
             title="Enviar correo">
            <i class="fa-solid fa-envelope"></i>
          </a>
        </div>
      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="4" class="text-center text-muted">No hay proveedores asociados.</td>
    </tr>
  {% endfor %}
</tbody>

            </table>
          </div>
        </div>

      </div>
    </div>
  </div>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    if(window.location.hash === "#proveedores") {
      var tabBtn = document.querySelector('button[data-bs-target="#proveedores"]');
      if(tabBtn){
        var tab = new bootstrap.Tab(tabBtn);
        tab.show();
      }
    }
  });
</script>
  {% endblock Contenido %}
</div>


